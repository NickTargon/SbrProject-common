<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>My task</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>
<body>
<div>
    <form action="/logout" method="post">
        <input type="submit" value="Sign Out"/>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
    </form>
</div>
<p><a th:href="@{/}">Start page</a></p>
<p><a th:href="@{'/course/{id}/tasks'(id=${course.getId()})}">All tasks</a></p>
<div th:text="${course.caption}"></div>
<div th:if="${isTeacher}">
    <table>
        <thead>
        <tr>
            <th> Task caption </th>
            <th> User </th>
            <th> Submitted date </th>
            <th> Mark </th>
            <th> Link </th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="utask : ${usertasks}">
            <td><span th:text="${utask.getTask().getTitle()}"> Title </span></td>
            <td><span th:text="${utask.getUser().getName()}"> Name </span></td>
            <td><span th:text="${utask.getSubmittedDate()}"> Sdate </span></td>
            <td><span th:text="${utask.getCurMark()}"> Sdate </span></td>
            <td>
                <a th:href="@{'/course/{idCourse}/tasks/{idTask}/{taskCaption}/{idUser}'
                      (idCourse=${course.getId()}, idTask=${task.getId()}, taskCaption=${task.getTitle()},
                      idUser=${usertask.getUser().getId()})}">
                    See task
                </a>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div th:if="${isStudent}">
    <table>
        <thead>
        <tr>
            <th> Task caption</th>
            <th> Task text</th>
            <th> Complete date</th>
            <th> Max mark</th>
            <th> Your mark</th>
            <th> Task state</th>
            <th> Submit date</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td><b><span th:text="${task.getTitle()}"> Title</span></b></td>
        </tr>
        <tr>
            <td><span th:text="${task.getText()}"> Text </span></td>
        </tr>
        <tr>
            <td><span th:text="${#temporals.format(task.getCompleteTime(), 'dd-MM-yyyy HH:mm:ss')}">
                                Complete date
                </span>
            </td>
            <td>Max mark: <span th:text="${task.getMaxMark()}"> Max Mark </span></td>
            <td>My mark:
                <span th:if="${usertask.getTaskState()}">
                    <p th:text="${usertask.curMark}"></p>
                </span>
            </td>
            <td>Task state:
                <span th:if="${usertask.getTaskState()}">
                    <p th:text="${usertask.getTaskState()}"></p>
                </span>
            </td>
            <td>Submit date:
                <span th:if="${usertask.getSubmittedDate()}">
                    <p th:text="${usertask.getSubmittedDate()}"></p>
                </span>
            </td>
        </tr>
        <tr th:if="!${usertask.getSubmittedDate()}" >
            <td>
                <form th:action="@{'/course/{idCourse}/tasks/{idTask}'
                      (idCourse=${course.getId()}, idTask=${task.getId()})}"
                      th:method="post">
                    <input type="hidden" name="_method" value="get"/>
                    <button type="submit" id="Submit task">Submit task</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>

</body>
</html>